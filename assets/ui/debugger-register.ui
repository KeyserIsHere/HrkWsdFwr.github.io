(gui "debugger-register"
    (namespace! :debugger-register)
    (state! ".colour" (0 0 0))
    (state! ".change-colour" (255 0 0))
    (state! ".text-alignment" :center)

    (state! ".text" (quote (render-text .rect
        (text: "r0 = " (flatten colour: .colour))
        (text: (format :hex .r0 (compact: #f) (precision: 2)) (flatten colour: (if .r0-modified .change-colour .colour)))
        (text: "\nr1 = " (flatten colour: .colour))
        (text: (format :hex .r1 (compact: #f) (precision: 2)) (flatten colour: (if .r1-modified .change-colour .colour)))
        (text: "\nr2 = " (flatten colour: .colour))
        (text: (format :hex .r2 (compact: #f) (precision: 2)) (flatten colour: (if .r2-modified .change-colour .colour)))
        (text: "\nr3 = " (flatten colour: .colour))
        (text: (format :hex .r3 (compact: #f) (precision: 2)) (flatten colour: (if .r3-modified .change-colour .colour)))
        (text: "\npc = " (flatten colour: .colour))
        (text: (format :hex .pc (compact: #f) (precision: 2)) (flatten colour: (if .pc-modified .change-colour .colour)))
        (text: "\nflags = " (flatten colour: .colour))
        (text: (format :hex .flags (compact: #f) (precision: 2)) (flatten colour: (if .flags-modified .change-colour .colour)))
        (text: " (o = " (flatten colour: .colour))
        (text: (format :dec .overflow-flag) (flatten colour: (if .overflow-flag-modified .change-colour .colour)))
        (text: ",s = " (flatten colour: .colour))
        (text: (format :dec .sign-flag) (flatten colour: (if .sign-flag-modified .change-colour .colour)))
        (text: ",c = " (flatten colour: .colour))
        (text: (format :dec .carry-flag) (flatten colour: (if .carry-flag-modified .change-colour .colour)))
        (text: ",z = " (flatten colour: .colour))
        (text: (format :dec .zero-flag) (flatten colour: (if .zero-flag-modified .change-colour .colour)))
        (text: ")" (flatten colour: .colour))
        (align: .text-alignment)
        (wrap: :word :multi)
        (offset: 0)
        (length: :max)
    )) (invalidate: (quote (if (frame-changed?) (any? .pc-changed .r0-changed .r1-changed .r2-changed .r3-changed .flags-changed .rect-changed) #f))))

    (render:
        .text
    )
)
